---
import type { VenueRef } from '../lib/sanity';

interface Props {
  id: string;
  artist: string;
  tour?: string;
  dateDisplay: string;
  image: string;
  status: 'on-sale' | 'coming-soon' | 'sold-out' | 'past';
  featured?: boolean;
  venue?: VenueRef;
  showVenueBadge?: boolean;
  ticketOne?: string;
  ticketZeta?: string;
  showTicketLinks?: boolean;
}

const {
  id,
  artist,
  tour,
  dateDisplay,
  image,
  status,
  featured = false,
  venue,
  showVenueBadge = true,
  ticketOne,
  ticketZeta,
  showTicketLinks = true
} = Astro.props;

const statusLabels = {
  'on-sale': 'In Vendita',
  'coming-soon': 'Coming Soon',
  'sold-out': 'Sold Out',
  'past': 'Evento Passato'
};

const statusColors = {
  'on-sale': 'bg-green-500 text-white',
  'coming-soon': 'bg-amber-500 text-black',
  'sold-out': 'bg-white/10 text-white/50',
  'past': 'bg-white/5 text-white/30'
};

// Venue badge colors
const venueBadgeColors = {
  'live-arena': 'bg-arena-red/80 text-white',
  'palaforum': 'bg-violet-600/80 text-white'
};

const venueShortName = venue?.shortName || 'live-arena';
const venueBadgeColor = venueBadgeColors[venueShortName as keyof typeof venueBadgeColors] || venueBadgeColors['live-arena'];
const venueDisplayName = venue?.name || 'Live Arena';

const hasTickets = (ticketOne || ticketZeta) && status !== 'past' && status !== 'sold-out';
---

<div class={`group relative ${featured ? 'md:col-span-2 md:row-span-2' : ''}`}>
  <!-- Card Container with Border -->
  <div class="relative overflow-hidden border border-white/10 hover:border-arena-red/50 transition-all duration-500 bg-arena-gray/30">
    <!-- Main Link Area -->
    <a href={`/eventi/${id}`} class="block">
      <!-- Image Container -->
      <div class={`relative overflow-hidden ${featured ? 'aspect-[16/9] md:aspect-[21/9]' : 'aspect-[4/5]'}`}>
        <img
          src={image}
          alt={artist}
          class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
          loading="lazy"
        />
        <!-- Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-t from-arena-black via-arena-black/50 to-transparent"></div>

        <!-- Glow Effect on Hover -->
        <div class="absolute inset-0 bg-arena-red/0 group-hover:bg-arena-red/10 transition-colors duration-500"></div>

        <!-- Badges Container -->
        <div class="absolute top-4 left-4 flex flex-col gap-2">
          <!-- Status Badge -->
          <span class={`px-3 py-1.5 text-xs uppercase tracking-wider font-medium ${statusColors[status]}`}>
            {statusLabels[status]}
          </span>

          <!-- Venue Badge -->
          {showVenueBadge && venue && (
            <span class={`px-3 py-1.5 text-xs uppercase tracking-wider font-medium ${venueBadgeColor}`}>
              {venueDisplayName === 'Live Arena' ? 'Live Arena' : 'Palaforum'}
            </span>
          )}
        </div>

        <!-- Content Overlay -->
        <div class="absolute bottom-0 left-0 right-0 p-6">
          <!-- Date -->
          <div class="flex items-center gap-2 mb-3">
            <div class="w-8 h-px bg-arena-red"></div>
            <span class="text-arena-red text-sm font-medium tracking-wider uppercase">{dateDisplay}</span>
          </div>

          <!-- Artist Name -->
          <h3 class={`font-display tracking-wide text-white mb-1 ${featured ? 'text-4xl md:text-6xl' : 'text-2xl md:text-3xl'}`}>
            {artist}
          </h3>

          <!-- Tour Name -->
          {tour && (
            <p class={`text-white/60 ${featured ? 'text-lg' : 'text-sm'}`}>{tour}</p>
          )}

          <!-- Scopri di più indicator -->
          <div class="flex items-center gap-2 mt-4 opacity-0 translate-y-2 group-hover:opacity-100 group-hover:translate-y-0 transition-all duration-300">
            <span class="text-arena-red text-sm font-medium tracking-wider uppercase">Scopri di più</span>
            <svg class="w-4 h-4 text-arena-red transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </div>
        </div>
      </div>
    </a>

    <!-- Ticket Links Section -->
    {showTicketLinks && hasTickets && (
      <div class="p-4 border-t border-white/10 bg-arena-black/50">
        <p class="text-white/40 text-xs uppercase tracking-wider mb-3">Acquista biglietti</p>
        <div class="flex gap-3">
          {ticketOne && (
            <a
              href={ticketOne}
              target="_blank"
              rel="noopener noreferrer"
              class="flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-blue-600 hover:bg-blue-500 text-white text-sm font-medium uppercase tracking-wider transition-colors"
              onclick="event.stopPropagation()"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path>
              </svg>
              TicketOne
            </a>
          )}
          {ticketZeta && (
            <a
              href={ticketZeta}
              target="_blank"
              rel="noopener noreferrer"
              class="flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-amber-600 hover:bg-amber-500 text-white text-sm font-medium uppercase tracking-wider transition-colors"
              onclick="event.stopPropagation()"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path>
              </svg>
              TicketZeta
            </a>
          )}
        </div>
      </div>
    )}

    <!-- Decorative Corner -->
    <div class="absolute top-0 right-0 w-16 h-16 overflow-hidden pointer-events-none">
      <div class="absolute top-0 right-0 w-32 h-1 bg-arena-red transform rotate-45 origin-top-right translate-x-8 -translate-y-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
    </div>
  </div>
</div>
