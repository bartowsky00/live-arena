---
import Layout from '../../layouts/Layout.astro';
import { getAllEvents } from '../../lib/events';

export async function getStaticPaths() {
  const events = await getAllEvents();
  return events.map(event => ({
    params: { slug: event.slug },
    props: { event }
  }));
}

const { event } = Astro.props;

// Verifica se l'evento è passato (basandosi sulla data)
const eventDate = new Date(event.dateEnd || event.date);
const today = new Date();
const isPastEvent = eventDate < today || event.status === 'past';

const statusLabels = {
  'on-sale': 'In Vendita',
  'coming-soon': 'Coming Soon',
  'sold-out': 'Sold Out',
  'past': 'Evento Passato'
};

const statusColors = {
  'on-sale': 'bg-green-500',
  'coming-soon': 'bg-amber-500',
  'sold-out': 'bg-arena-red',
  'past': 'bg-white/20'
};
---

<Layout title={event.artist} description={event.description}>
  <!-- Hero Section -->
  <section class="relative min-h-[70vh] flex items-end overflow-hidden">
    <!-- Background Image -->
    <div class="absolute inset-0">
      <img
        src={event.image}
        alt={event.artist}
        class="w-full h-full object-cover"
      />
      <div class="absolute inset-0 bg-gradient-to-t from-arena-black via-arena-black/80 to-arena-black/30"></div>
      <div class="absolute inset-0 bg-gradient-to-r from-arena-black/50 to-transparent"></div>
    </div>

    <!-- Content -->
    <div class="relative z-10 max-w-7xl mx-auto px-6 py-16 w-full">
      <!-- Back Link -->
      <a href="/eventi" class="inline-flex items-center gap-2 text-white/60 hover:text-white mb-8 transition-colors">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
        <span>Tutti gli eventi</span>
      </a>

      <!-- Status Badge -->
      <div class="mb-4">
        <span class={`inline-block px-4 py-2 text-sm uppercase tracking-wider font-medium text-white ${isPastEvent ? 'bg-white/20' : statusColors[event.status]}`}>
          {isPastEvent ? 'Evento Passato' : statusLabels[event.status]}
        </span>
      </div>

      <!-- Date -->
      <div class="flex items-center gap-3 mb-4">
        <div class="w-12 h-px bg-arena-red"></div>
        <span class="text-arena-red text-xl font-medium tracking-wider uppercase">{event.dateDisplay}</span>
      </div>

      <!-- Artist Name -->
      <h1 class="font-display text-5xl sm:text-7xl md:text-8xl tracking-wider text-white mb-4">
        {event.artist}
      </h1>

      <!-- Tour Name -->
      {event.tour && (
        <p class="text-2xl text-white/70 mb-8">{event.tour}</p>
      )}
    </div>
  </section>

  <!-- Content Section -->
  <section class="py-16 md:py-24 bg-arena-black">
    <div class="max-w-7xl mx-auto px-6">
      <div class="grid lg:grid-cols-3 gap-12">
        <!-- Main Content -->
        <div class="lg:col-span-2">
          <h2 class="font-display text-3xl tracking-wider text-white mb-6">L'EVENTO</h2>
          <p class="text-white/70 text-lg leading-relaxed mb-8">
            {event.description}
          </p>

          <!-- Event Details -->
          <div class="grid sm:grid-cols-2 gap-6 mt-12">
            <div class="p-6 bg-arena-gray border border-white/5">
              <div class="flex items-center gap-4 mb-4">
                <div class="w-12 h-12 bg-arena-red/10 flex items-center justify-center">
                  <svg class="w-6 h-6 text-arena-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                </div>
                <div>
                  <p class="text-white/50 text-sm uppercase tracking-wider">Data</p>
                  <p class="text-white font-medium">{event.dateDisplay}</p>
                </div>
              </div>
            </div>

            <div class="p-6 bg-arena-gray border border-white/5">
              <div class="flex items-center gap-4 mb-4">
                <div class="w-12 h-12 bg-arena-red/10 flex items-center justify-center">
                  <svg class="w-6 h-6 text-arena-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                </div>
                <div>
                  <p class="text-white/50 text-sm uppercase tracking-wider">Location</p>
                  <p class="text-white font-medium">Live Arena</p>
                  <p class="text-white/50 text-sm">Via Esa Chimento, Agrigento</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Sidebar - Tickets -->
        <div class="lg:col-span-1">
          <div class="sticky top-24 p-8 bg-arena-gray border border-white/5">
            <h3 class="font-display text-2xl tracking-wider text-white mb-6">BIGLIETTI</h3>

            {isPastEvent ? (
              <div class="text-center">
                <div class="w-16 h-16 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-4">
                  <svg class="w-8 h-8 text-white/30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                </div>
                <p class="text-white/50">Questo evento si è già svolto.</p>
                <a href="/eventi" class="inline-block mt-4 text-arena-red hover:text-arena-red-glow text-sm">
                  Scopri i prossimi eventi →
                </a>
              </div>
            ) : event.status === 'sold-out' ? (
              <div class="text-center">
                <p class="text-arena-red font-medium text-lg mb-2">Sold Out!</p>
                <p class="text-white/50 text-sm">I biglietti per questo evento sono esauriti.</p>
              </div>
            ) : (
              <>
                {/* Prices */}
                {event.prices && event.prices.length > 0 && (
                  <div class="mb-8">
                    <p class="text-white/50 text-sm uppercase tracking-wider mb-4">Prezzi</p>
                    <ul class="space-y-3">
                      {event.prices.map((price: {type: string, price: number}) => (
                        <li class="flex justify-between items-center">
                          <span class="text-white/70">{price.type}</span>
                          <span class="text-white font-medium">€{price.price.toFixed(2)}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}

                {/* Ticket Buttons */}
                <div class="space-y-4">
                  {event.ticketOne && (
                    <a
                      href={event.ticketOne}
                      target="_blank"
                      rel="noopener"
                      class="block w-full py-4 bg-arena-red hover:bg-arena-red-glow text-white text-center font-medium tracking-wider uppercase transition-colors"
                    >
                      Acquista su TicketOne
                    </a>
                  )}
                  {event.ticketZeta && (
                    <a
                      href={event.ticketZeta}
                      target="_blank"
                      rel="noopener"
                      class="block w-full py-4 bg-white/10 hover:bg-white/20 text-white text-center font-medium tracking-wider uppercase transition-colors"
                    >
                      Acquista su TicketZeta
                    </a>
                  )}
                </div>

                {event.status === 'coming-soon' && (
                  <p class="text-amber-500 text-sm mt-4 text-center">Biglietti in vendita a breve</p>
                )}
              </>
            )}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Map Section -->
  <section class="py-16 bg-arena-dark">
    <div class="max-w-7xl mx-auto px-6">
      <h2 class="font-display text-3xl tracking-wider text-white mb-8">COME ARRIVARE</h2>
      <div class="aspect-[21/9] bg-arena-gray relative overflow-hidden">
        <iframe
          src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3173.8!2d13.57!3d37.31!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2sVia+Esa+Chimento%2C+92100+Agrigento+AG!5e0!3m2!1sit!2sit!4v1"
          width="100%"
          height="100%"
          style="border:0; filter: grayscale(100%) invert(92%) contrast(83%);"
          allowfullscreen
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
          title="Mappa Live Arena"
        ></iframe>
        <div class="absolute inset-0 border border-arena-red/20 pointer-events-none"></div>
      </div>
    </div>
  </section>

  <!-- Other Events -->
  <section class="py-16 md:py-24 bg-arena-black">
    <div class="max-w-7xl mx-auto px-6">
      <h2 class="font-display text-3xl tracking-wider text-white mb-8">ALTRI EVENTI</h2>
      <a
        href="/eventi"
        class="inline-flex items-center gap-3 text-arena-red hover:text-arena-red-glow transition-colors group"
      >
        <span class="tracking-wider uppercase font-medium">Scopri tutti gli eventi</span>
        <svg class="w-5 h-5 transform group-hover:translate-x-2 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
        </svg>
      </a>
    </div>
  </section>
</Layout>
